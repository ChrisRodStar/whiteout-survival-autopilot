# TODO: add case for resource shortage - obtain more

name: Upgrade Alliance Tech # Usecase name â€” upgrade alliance technology

node: alliance_tech         # Starting screen â€” "alliance technologies"

priority: 20

ttl: 90m                    # Timeout: re-execution possible after 90 minutes

steps:
  - action: screenshot               # ğŸ“¸ Look for technology icon with green thumbs up (favorite technology)
    analyze:
      - name: alliance.tech.favorite
        action: findIcon
        threshold: 0.8
        saveAsRegion: true          # ğŸ’¾ Save found icon zone under name alliance.tech.favorite

  - click: alliance.tech.favorite   # ğŸ‘‰ Click on found technology to open screen with "Contribute" button

  - wait: 200ms # Wait for animation rendering

  - action: screenshot               # ğŸ“¸ Take screenshot of current screen
    analyze:
      - name: alliance.state.isAllianceContributeButton
        action: color_check          # ğŸ¨ Check color of "Contribute" button
        expectedColorBg: blue
        threshold: 0.5

  - if:
      trigger: "alliance.state.isAllianceContributeButton == false"
      then:
        - click: alliance_tech_contribute_back

  - action: loop                     # ğŸ” Start loop while "Contribute" button remains blue
    trigger: alliance.state.isAllianceContributeButton
    steps:
      - longtap: alliance.state.isAllianceContributeButton
        wait: 3s                     # ğŸ§· Hold button (longtap) for 3 seconds â€” this increases contribution

      - action: screenshot           # ğŸ“¸ After pressing, take screenshot again
        analyze:
          - name: alliance.state.isAllianceContributeButton
            action: color_check
            expectedColorBg: blue
            threshold: 0.5

      - if:
          trigger: "!alliance.state.isAllianceContributeButton"
          then:
            - click: alliance_tech_contribute_back
